window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,1e3/60)};var canvas=document.getElementById("c"),ctx=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var settings={abstract:{emission_rate:200,min_life:0,life_range:2,min_angle:0,angle_range:360,min_speed:1,speed_range:150,min_size:.5,size_range:3,start_colours:[[120,0,255,1],[120,0,255,1],[120,0,255,1]],end_colours:[[120,0,255,.2],[120,0,255,.2],[120,0,255,.2]],gravity:{x:0,y:0},min_position:{x:-30,y:-30},position_range:{x:60,y:60}},blood:{emission_rate:1e3,min_life:1,life_range:1,min_angle:85,angle_range:10,min_speed:10,speed_range:100,min_size:2,size_range:2,start_colours:[[253,69,69,.8],[201,10,10,.8],[168,57,57,.8]],end_colours:[[253,69,69,.1],[201,10,10,.1],[168,57,57,.1]],gravity:{x:0,y:100}},fire:{emission_rate:1e3,min_life:1,life_range:.5,min_angle:80,angle_range:20,min_speed:10,speed_range:140,min_size:2,size_range:10,start_colours:[[239,127,67,.7],[253,69,69,.8],[239,100,67,.7]],end_colours:[[90,90,90,0],[110,110,110,0],[130,130,130,0]],gravity:{x:0,y:-100},min_position:{x:-20,y:-20},position_range:{x:40,y:40}},rain:{emission_rate:50,min_life:2,life_range:.3,min_angle:260,angle_range:20,min_speed:30,speed_range:30,min_size:1,size_range:2,start_colours:[[130,196,245,.8],[69,152,212,.8]],end_colours:[[130,196,245,.3],[69,152,212,.3]],gravity:{x:20,y:100},min_position:{x:0,y:0},position_range:{x:canvas.width-200,y:0}}},Particle=function(i,t,e,s,n,a,o,r){this.pos={x:i||0,y:t||0},this.speed=s||5,this.life=n||1,this.size=a||2,this.lived=0;var l=e*Math.PI/180;this.vel={x:Math.cos(l)*s,y:-Math.sin(l)*s},this.colour=o,this.colour_step=r},Emitter=function(i,t,e){this.pos={x:i,y:t},this.settings=e,this.emission_delay=1e3/e.emission_rate,this.last_update=0,this.last_emission=0,this.particles=[],this.position_vary=this.settings.position_range||!1,this.min_position=this.settings.min_position||{x:0,y:0}};Emitter.prototype.update=function(){if(this.last_update){var i=Date.now(),t=i-this.last_update;if(this.last_emission+=t,this.last_update=i,this.last_emission>this.emission_delay){var e=Math.floor(this.last_emission/this.emission_delay);for(this.last_emission-=e*this.emission_delay;e--;){var s=this.settings.start_colours[Math.floor(this.settings.start_colours.length*Math.random())],n=this.settings.end_colours[Math.floor(this.settings.end_colours.length*Math.random())],a=this.settings.min_life+Math.random()*this.settings.life_range,o=[(n[0]-s[0])/a,(n[1]-s[1])/a,(n[2]-s[2])/a,(n[3]-s[3])/a];this.particles.push(new Particle(this.min_position.x+(this.position_vary?Math.random()*this.position_vary.x:0),this.min_position.y+(this.position_vary?Math.random()*this.position_vary.y:0),this.settings.min_angle+Math.random()*this.settings.angle_range,this.settings.min_speed+Math.random()*this.settings.speed_range,a,this.settings.min_size+Math.random()*this.settings.size_range,s.slice(),o))}}t/=1e3;for(e=this.particles.length;e--;){var r=this.particles[e];if(r.dead)this.particles.splice(e,1);else if(r.lived+=t,r.lived>=r.life)r.dead=!0;else{r.vel.x+=this.settings.gravity.x*t,r.vel.y+=this.settings.gravity.y*t,r.pos.x+=r.vel.x*t,r.pos.y+=r.vel.y*t,r.colour[0]+=r.colour_step[0]*t,r.colour[1]+=r.colour_step[1]*t,r.colour[2]+=r.colour_step[2]*t,r.colour[3]+=r.colour_step[3]*t,ctx.fillStyle="rgba("+Math.round(r.colour[0])+","+Math.round(r.colour[1])+","+Math.round(r.colour[2])+","+r.colour[3]+")";var l=this.pos.x+r.pos.x,h=this.pos.y+r.pos.y;ctx.beginPath(),ctx.arc(l,h,r.size,0,2*Math.PI),ctx.fill()}}}else this.last_update=Date.now()};var emitter=new Emitter(canvas.width/2,canvas.height/2,settings.abstract);function loop(){ctx.clearRect(0,0,canvas.width,canvas.height),emitter.update(),requestAnimFrame(loop)}function rain(){emitter=new Emitter(100,60,settings.rain)}function abstract(){emitter=new Emitter(canvas.width/2,canvas.height/2,settings.abstract)}function blood(){emitter=new Emitter(canvas.width/2,canvas.height/2,settings.blood)}function fire(){emitter=new Emitter(canvas.width/2,canvas.height/2,settings.fire)}console.log(emitter),loop();